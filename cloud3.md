# глисток облака 3

## Вопрос 1

Варианты решения:

1. Поднять CDN-сервера, чтоб запрос сначала шел к ним (+ получим кэширование порегионно)
2. Anycast-dns - объявляем, что несколько серверов имеют один и тот же ip адрес, а затем просто на уровне маршрутизаторов направляем пакет к ближайшей ноде
3. Можно настроить в DNS так, чтобы они выдавали айпишник который находится в регионе пользователя
4. Можно воспользоваться старым мемом "а я тебя по айпи вычислю" и действительно воспользоваться распределенной бдшкой которая матчит айпишники и регион сервиса

## Вопрос 2

Как буду исследовать причины

1) Проверю есть ли проблемы со скидыванием файлов из А в А и из Б в Б
2) Посмотрю на маршрут пакетов с помощью traceroute
3) Посмотрю на логи/метрики - наверняка в момент времени когда это началось случилось еще какое-то событие (например может кто-то релиз покатил)

Куда писать

1) В поддержку А и Б - может дежурные в курсе
2) В чат инцидентов - возможно там уже люди чинят проблему

Костыльное временное решение:

Лить трафик не по Б->А, а по Б->В->А

Если просто поднть 1 тачку и на ней переливать, то она может отвалиться по многим параметрам. Поэтому разумнее поднять n виртуальных тачек и поставить еще nginx, чтоб балансировать трафик между ними


## Вопрос 3

#### Вариант 1: делаем процессинг в aws 

Данные наливаются равномерно, поэтому будем считать что в среднем на aws в месяц хранится 250 ТБ данных. Посчитаем сколько это уйдет денег на хранение 

Там немного разные ценны для разных объемов, но они все несильно отличаются, будем считать, что хранить стоит 0.022 долларов за гигабайт. Итого 0.022 * 250 * 1024 = 5632 долларов в месяц

Теперь считаем компьют. Будем использовать местный моп-редьюс

Сама аренда ядер стоит 1200 * 24 * 0.052 = 1497.6 долларов

Еще стоит учитывать память, но чет не сказали сколько на процессинг надо, но если указывать какие-то разумные числа, то там выходят копейки относительно cpu.

Будем считать, что все на aws стоит 7130 долларов в месяц

#### Вариант 2: переезжаем

Исходящий трафик - в среднем будем считать 87 долларов за терабайт, нам в месяц нужно перекидывать 42, итого 3654 за пересылку

Хранилище Wasabi стоит 21000 долларов в год за наши 500 ТБ в год, то есть 1750 в месяц

CPU: будем брать какой-то средний, стоит примерно 0.0075 долларов, итого 0.0075  * 24 * 1200 * 12 = 2590 долларов

Итог: 7990 долларов за решение с переездом, то есть выгоднее все делать на AWS
